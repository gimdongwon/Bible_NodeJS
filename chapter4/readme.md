# http 모듈로 서버만들기

## 목차

1. 요청과 응답 이해하기
2. REST와 라우팅 사용하기
3. 쿠키와 세션 이해하기
4. https와 http2
5. cluster
6. 함께 보면 좋은 자료

이 장에서는 드디어 실제로 돌아가는 서버를 만든다. 지금까지 배운 다양한 모듈을 사용할 예정이다.

### 4.1 요청과 응답하기

서버는 클라이언트가 있기에 동작한다. 클라이언트에서 서버로 요청을 보내고 서버에서는 요청의 내용을 읽고 처리한 뒤 클라이언트에 응답을 보낸다. 따라서 서버에는 요청을 받는 부분과 보내는 부분이 있어야 한다. 요청과 응답은 이벤트 방식이라고 생각하면 된다. 클라이언트로부터 요청이 왔을 때 어떤 작업을 수행할지 이벤트리스너를 미리 등록해두어야 한다.

port는 서버 내에서 프로세스를 구분하는 번호이다. 서버는 HTTP 요청을 대기하는 것 외에도 다양한 작업을 한다. 데이터베이스와도 통신해야 하고, FTP 요청을 처리하기도 한다. 따라서 `서버는 프로세스에 포트를 다르게 할당하여 들어오는 요청을 구분한다.` 유명한 포트로는 21(FTP), 80(HTTP), 443(HTTPS), 3306(MYSQL)이 있다.

res 객체에는 res.writeHead와 res.write, res.end 메서드가 있다.

writeHead에는 헤더를 사용하고, write는 클라이언트에 보낼 데이터 body, end에는 응답을 종료하는 메서드이다.

> 한 번에 여러 서버를 실행할 수도 있다.

html파일을 fs모듈로 읽어와서 전송할 수 있다.

ex) server2.html을 createServer.js에서 불러옴.

> 요청 처리 과정 중에 에러가 발생했다고 해서 응답을 보내지 않으면 안된다. 요청이 성공했든 실패했든 응답을 클라이언트로 보내서 요청이 마무리되었음을 알려야 한다. 응답을 보내지 않는다면, 클라이언트는 서버로부터 응답이 오길 하염없이 기다리다가 일정 시간 후 Timeout 처리한다.

## 4.2 REST와 라우팅 사용하기

서버에 요청을 보낼 때는 주소를 통해 요청의 내용을 표현한다. 주소가 /index.html이면 서버의 index.html을 보내달라는 뜻이고, /about.html이면 about.html을 보내달라는 뜻이다.

항상 html만 요청할 필요는 없다. css나 js 또는 이미지 같은 파일을 요청할 수도 있고 특정 동작을 행하는 것을 요청할 수도 있다. 요청의 내용이 주소를 통해 표현되므로 서버가 이해하기 쉬운 주소를 사용하는 것도 좋다. 여기서 REST가 등장한다.

REST는 REpresentational State Transfer의 줄임말이며, 서버의 자원을 정의하고 자원에 대한 주소를 지정하는 방법을 가리킨다. 일종의 약속이라고 봐도 무방하다. 자원이라고 해서 꼭 파일일 필요는 없고 서버가 행할 수 있는 것들을 통틀어서 의미한다고 보면 된다. REST API에는 많은 규칙들이 있는데 모든 규칙을 지키는 것은 현실적으로 어려우므로, 이 책에서는 기본적인 개념만 빌려 사용한다.

주소는 의미를 명확히 전달하기 위해 명사로 구성된다. /user이면 사용자 정보에 관련된 자원을 요청하는 것이고, /post라면 게시글에 관련된 자원을 요청하는 것이라고 추측할 수 있다.

단순히 명사만 있으면 무슨 동작을 행하라는 것인지 알기 어려우므로 REST에서는 주소 외에도 HTTP 요청 메서드 라는 것을 사용한다. 폼 데이터를 전송할 때 GET 또는 POST 메서드를 지정한다.

주소 하나가 요청 메서드를 여러 개 가질 수 있다. GET 메서드의 /user 주소로 요청을 보내면 사용자 정보를 가져오는 요청이라는 것을 알 수 있다. POST 메서드의 /user주소로 요청을 보내면 새로운 사용자를 등록한다는 것을 알 수 있다. 이렇게 주소와 메서드만 보고 요청의 내용을 알 수 있다는 장점이 있다. 또한 GET 메서드는 브라우저에서 캐싱할 수도 있으므로 같은 주소로 GET요청을 할 때 서버에서 가져오는 것이라 아니라 캐시에서 가져올 수도 있다.

> res.end 앞에 return 을 붙여야만 함수가 종료된다.

REST방식으로 주소를 만들었으므로 주소와 메서드만 봐도 요청 내용을 유추할 수 있다. Name은 요청 주소를 method는 요청 메서드를, Status는 HTTP 응답 코드를, Protocol은 통신 프로토콜을, Type은 요청의 종류를 의미한다. xhr는 AJAX 요청이다.

General은 공통된 헤더이고 Request Headers는 요청의 헤더, Response Headers는 응답의 헤더이다. Request Payload가 요청의 본문이다. 응답의 본문은 Preview나 Response 탭에서 확인할 수 있다.
